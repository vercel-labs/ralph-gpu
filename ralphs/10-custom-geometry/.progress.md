# Progress - Custom Geometry and Index Buffer Support

## Summary
Task completed successfully. Added custom geometry support with index buffers to ralph-gpu.

## Completed
- [x] **Fix Globals Binding** - Added `usesGlobals` detection with regex `/\bglobals\.\w+/` to Material class
- [x] **Add Index Buffer Support** - Added `IndexFormat` type, properties to MaterialOptions, and `drawIndexed()` implementation
- [x] **Create Triangle Example** - Triangle rendered using storage buffer for positions
- [x] **Create Cube Example** - Rotating cube with 8 vertices + 36 indices, MVP matrix, vertex-colored
- [x] **Update Lines Example** - Added storage buffer lines section with animated rainbow lines
- [x] **Quality Checks** - All examples render correctly, no console errors

## Changes Made

### 1. packages/core/src/types.ts
- Added `IndexFormat` type: `"uint16" | "uint32"`
- Added to `MaterialOptions`: `indexBuffer`, `indexFormat`, `indexCount`

### 2. packages/core/src/material.ts
- Added `usesGlobals` property with regex detection
- Added `indexBuffer`, `indexFormat`, `indexCount` properties
- Constructor now handles index buffer options
- `drawInternal` uses `drawIndexed()` when index buffer present
- Globals struct injection properly gated behind `usesGlobals` check

### 3. packages/core/src/index.ts
- Exported `IndexFormat` type

### 4. apps/examples/app/geometry/page.tsx
- Created new page with triangle (no index buffer) and cube (with index buffer) examples
- Triangle uses 3 vertices from storage buffer
- Cube uses 8 vertices + 36 indices with MVP matrix and animation

### 5. apps/examples/app/lines/page.tsx
- Added second canvas with storage buffer lines example
- Uses `line-list` topology with vertex shader animation
- Kept existing SDF line examples

## Verification
- TypeScript compiles: ✅ `pnpm build` succeeds
- Triangle example: ✅ Red triangle visible
- Cube example: ✅ Rotating cube with vertex colors
- Lines example: ✅ Both SDF and storage buffer lines animate correctly
- Particles example: ✅ Still works correctly
- No console errors: ✅ Verified in browser

## Last Updated
Task completed successfully.
